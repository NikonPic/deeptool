---

title: MoCoAE

keywords: fastai
sidebar: home_sidebar

summary: "Momentum Contrast for Autoencoder based Representation Learning"
description: "Momentum Contrast for Autoencoder based Representation Learning"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs\24_mocoae.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include image.html alt="Drawing" style="width: 700px;" file="/deeptool/img\mocoae.PNG" %}</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="MoCoAE" class="doc_header"><code>class</code> <code>MoCoAE</code><a href="https://github.com/NikonPic/deeptool/tree/master/deeptool/model/mocoae.py#L16" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>MoCoAE</code>(<strong><code>device</code></strong>, <strong><code>args</code></strong>) :: <a href="/deeptool/abstract_model#AbsModel"><code>AbsModel</code></a></p>
</blockquote>
<p>The MoCoAE contains the Autoencoder based Architecture and the modified Pretext task</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Functions-handling-the-queue">Functions handling the queue<a class="anchor-link" href="#Functions-handling-the-queue"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="concat_all_gather" class="doc_header"><code>concat_all_gather</code><a href="https://github.com/NikonPic/deeptool/tree/master/deeptool/model/mocoae.py#L280" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>concat_all_gather</code>(<strong><code>tensor</code></strong>)</p>
</blockquote>
<p>Performs all_gather operation on the provided tensors.
<strong><em> Warning </em></strong>: torch.distributed.all_gather has no gradient.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Functions-Handling-the-K-and-Q-Network-updates:">Functions Handling the K and Q Network updates:<a class="anchor-link" href="#Functions-Handling-the-K-and-Q-Network-updates:"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="copy_q2k_params" class="doc_header"><code>copy_q2k_params</code><a href="https://github.com/NikonPic/deeptool/tree/master/deeptool/model/mocoae.py#L295" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>copy_q2k_params</code>(<strong><code>Q_network</code></strong>:<code>Module</code>, <strong><code>K_network</code></strong>:<code>Module</code>)</p>
</blockquote>
<p>Helper function to Copy parameters from Network Q to network K.
Further deactive gradient computation on k</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="momentum_update" class="doc_header"><code>momentum_update</code><a href="https://github.com/NikonPic/deeptool/tree/master/deeptool/model/mocoae.py#L306" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>momentum_update</code>(<strong><code>Q_network</code></strong>:<code>Module</code>, <strong><code>K_network</code></strong>:<code>Module</code>, <strong><code>m</code></strong>:<code>float</code>)</p>
</blockquote>
<p>Momentum update of the key network based on the query network</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Momentum-Contrastive-Loss:">Momentum Contrastive Loss:<a class="anchor-link" href="#Momentum-Contrastive-Loss:"> </a></h2><p>$ Loss = -\log \left( \frac{ \exp{ \frac{q \cdot k_+}{\tau} } }{\sum_{i=0}^{n}{\exp{\frac{q \cdot k_i}{\tau}  }} } \right) $</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="MomentumContrastiveLoss" class="doc_header"><code>MomentumContrastiveLoss</code><a href="https://github.com/NikonPic/deeptool/tree/master/deeptool/model/mocoae.py#L316" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>MomentumContrastiveLoss</code>(<strong><code>k</code></strong>, <strong><code>W</code></strong>, <strong><code>q</code></strong>, <strong><code>queue</code></strong>, <strong><code>device</code></strong>, <strong><code>tau</code></strong>=<em><code>1</code></em>)</p>
</blockquote>
<p>Calculate the loss of the network depending on the current key(k), the query(q)
and the overall queue(queue)
We follow the suggestion of the paper, Algorithm 1:
<a href="https://arxiv.org/pdf/1911.05722.pdf">https://arxiv.org/pdf/1911.05722.pdf</a></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

